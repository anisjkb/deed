{# src/backend/templates/projects/detail.html #}
{% extends "base.html" %}
{% block content %}

{# ───────────────────────── HERO ───────────────────────── #}
<section class="hero-project">
  <img
    src="{{ project.hero_image_url or '/static/images/project1.jpg' }}"
    alt="{{ project.title }} hero"
    width="1600"
    height="900">
    {# hero_image_url ← projects.hero_image_url; title ← projects.title (for alt) #}

  <div class="hero-overlay container">
    <h1 class="h1">{{ project.title }}</h1>
    {# title ← projects.title #}

    {# Optional tagline line #}
    {% if project.tagline %}
      <p class="muted">Tagline: {{ project.tagline }}</p>
      {# tagline ← projects.tagline #}
    {% endif %}

    <p class="muted">
      {{ project.location }} · {{ project.ptype.value|title }} · {{ project.status|title }}
    </p>
    {# location ← projects.location
       ptype    ← projects.ptype (ENUM projecttype; use .value)
       status   ← projects.status (VARCHAR; no .value) #}

    <a class="btn btn-light" href="#schedule">Schedule a Meeting</a>
  </div>
</section>

{# ───────────────────────── OVERVIEW ───────────────────────── #}
<section class="section container grid-2">
  <div>
    <h2 class="h3">Overview</h2>

    <p>{{ project.short_desc or 'A premium development with thoughtful amenities and design.' }}</p>
    {# short_desc ← projects.short_desc #}

    <ul class="specs">
      {% if project.size_range %}
        <li><strong>Size range:</strong> {{ project.size_range }}</li>
        {# size_range ← projects.size_range #}
      {% endif %}

      {% if project.floors is not none %}
        <li><strong>Floors:</strong> {{ project.floors }}</li>
        {# floors ← projects.floors (INT) #}
      {% endif %}

      {% if project.handover_date %}
        <li><strong>Handover:</strong> {{ project.handover_date }}</li>
        {# handover_date ← projects.handover_date (DATE) #}
      {% endif %}
    </ul>

    <h3 class="h4">Project Progress</h3>
    <div class="progress lg">
      <div class="bar" style="width: {{ project.progress_pct }}%"></div>
      <span class="pct">{{ project.progress_pct }}%</span>
    </div>
    {# progress_pct ← projects.progress_pct #}

    {# ───────────── Highlights (pretty rendering) ───────────── #}
    {% if project.highlights and project.highlights|trim %}
      {% set hl = project.highlights.strip() %}
      <section class="stack" style="margin-top:1.25rem">
        <h3 class="h4">Highlights</h3>
        {# highlights ← projects.highlights (TEXT) #}

        {# Case-1: Already HTML list -> render safely as-is #}
        {% if '<li' in hl or '<ul' in hl or '<ol' in hl %}
          <div class="wysiwyg">
            {{ hl | safe }}
          </div>

        {# Case-2: Multi-line plain text -> newline to bullets #}
        {% elif '\n' in hl %}
          {% set lines = hl.split('\n') | map('trim') | reject('equalto','') | list %}
          {% if lines %}
            <ul class="bullets">
              {% for line in lines %}
                <li>{{ line }}</li>
              {% endfor %}
            </ul>
          {% endif %}

        {# Case-3: Comma-separated -> bullets #}
        {% elif ',' in hl %}
          {% set items = hl.split(',') | map('trim') | reject('equalto','') | list %}
          {% if items %}
            <ul class="bullets">
              {% for item in items %}
                <li>{{ item }}</li>
              {% endfor %}
            </ul>
          {% endif %}

        {# Fallback: plain paragraph #}
        {% else %}
          <p>{{ hl }}</p>
        {% endif %}
      </section>
    {% endif %}

    {# Optional static updates block — keep or remove as desired #}
    <ul class="bullets">
      <li>Update #1: structure or finishing status</li>
      <li>Update #2: recent milestone</li>
    </ul>
  </div>

  {# ───────────────────────── SIDECARD ───────────────────────── #}
  <div>
    <div class="info-card">
      <h3 class="h4">Interested?</h3>
      <p>Share your details; our advisor will reach out.</p>
      <a href="#schedule" class="btn btn-secondary">Schedule</a>
    </div>
  </div>
</section>

{# ───────────────────────── SCHEDULE FORM ───────────────────────── #}
{% include 'partials/_schedule_meeting.html' %}
{# Partial posts to meeting_requests; not tied to projects table #}

{% endblock %}
